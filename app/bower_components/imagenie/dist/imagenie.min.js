/*
imagenie v.0.0.3 - Image manipulation made easy (JS library)
01-03-2015
*/
!function(a,b){"function"==typeof define&&define.amd?define([],function(){return a.Imagenie=b(a)}):a.Imagenie=b(a)}(this,function(){"use strict";function a(){var a=this,c=arguments;h=[],function(){[].forEach.call(c,function(c){"string"==typeof c?i.isValidURL(c)?(i.log("Image URL"),h.push(b.call(a,c))):document.querySelectorAll(c).length>0&&(i.log("Image element selector"),[].forEach.call(document.querySelectorAll(c),function(a){"IMG"===a.nodeName&&h.push({elem:a,src:a.src,source:f(a),complete:a.complete})})):("NodeList"===c.constructor.name||"HTMLCollection"===c.constructor.name)&&(i.log("Image nodes list"),[].forEach.call(c,function(a){"IMG"===a.nodeName&&h.push({elem:a,source:f(a),src:a.src,complete:a.complete})}))})}()}function b(a){var b=new Image,e=this,g={elem:b,source:null,src:a,complete:!1};return b.addEventListener("load",function(){g.source=f(b),g.complete=b.complete,d.call(e)}),b.addEventListener("error",function(){g.complete=!1,c.call(e)}),b.src=a,g}function c(){var a=h.some(function(a){return a.complete===!1});a&&this.errorCallback&&"function"==typeof this.errorCallback&&(this.errorCallback(),this.errorCallback=null)}function d(){var a=h.every(function(a){return a.complete===!0});a&&this.successCallback&&"function"==typeof this.successCallback&&(this.successCallback(),this.successCallback=null)}function e(a){return k.drawImage(a,0,0,a.width,a.height),k.getImageData(0,0,a.width,a.height).data}function f(a){return a.hasOwnProperty("src")?(k.drawImage(a,0,0,a.width,a.height),k.canvas.toDataURL()):void 0}function g(a){h.forEach(function(b){var c,d;k.drawImage(b.elem,0,0,b.elem.width,b.elem.height),c=k.getImageData(0,0,b.elem.width,b.elem.height),d=c.data;for(var e=0,f=d.length;f>e;e+=4)a(d,e);k.context.putImageData(c,0,0),b.elem.src=k.canvas.toDataURL()})}var h,i={log:function(){j.debug&&console.log.apply(console,arguments)},isValidURL:function(a){return!!a.match(/^https?:\/\/|\.(png|jpg|gif)$/)},extend:function(a,b){var c=Object.create(a);return Object.keys(b).map(function(a){a in c&&(c[a]=b[a])}),c}},j={debug:!0},k={_init:function(){this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d")},reset:function(a,b){this.canvas.height=b,this.canvas.width=a,this.context.clearRect(0,0,a,b)},drawImage:function(a,b,c,d,e){this.reset(d,e),this.context.drawImage(a,b,c,d,e)},cropImage:function(a,b,c,d,e,f,g,h,i){this.clear(d,e),this.context.drawImage(a,b,c,d,e,f,g,h,i)},getImageData:function(a,b,c,d){return this.context.getImageData(a,b,c,d)}};return k._init(),a.prototype.ready=function(a,b){this.successCallback="function"==typeof a&&a,this.errorCallback="function"==typeof b&&b,c.call(this),d.call(this)},a.prototype["export"]=function(){h.forEach(function(a){window.open(a.elem.src,a.src)})},a.prototype.size=function(){return h.map(function(a){return{src:a.src,displayWidth:a.elem.width,displayHeight:a.elem.height,naturalWidth:a.elem.naturalWidth,naturalHeight:a.elem.naturalHeight}})},a.prototype.pixel=function(a,b){return a>=0&&b>=0?h.map(function(c){var d=e(c.elem);return{R:d[4*(c.elem.width*b+a)],G:d[4*(c.elem.width*b+a)+1],B:d[4*(c.elem.width*b+a)+2],A:d[4*(c.elem.width*b+a)+3]}}):void 0},a.prototype.transparency=function(){return h.map(function(a){for(var b=e(a),c=0;c<a.elem.height;c++)for(var d=0;d<a.elem.width;d++)if(b[4*(a.elem.width*c+d)+3]<255)return!0;return!1})},a.prototype.crop=function(a,b,c,d){return a>=0&&b>=0&&c>0&&d>0&&h.forEach(function(e){k.cropImage(e.elem,a,b,c,d,0,0,c,d),e.elem.src=k.canvas.toDataURL()}),this},a.prototype.alpha=function(a,b){return a>=0&&1>=a&&g(function(c,d){(!b||c[d+3]>0)&&(c[d+3]=255*a)}),this},a.prototype.scale=function(a){return a>0&&h.forEach(function(b){k.drawImage(b.elem,0,0,b.elem.width*Math.max(0,a),b.elem.height*Math.max(0,a)),b.elem.src=k.canvas.toDataURL()}),this},a.prototype.reset=function(){return h.forEach(function(a){a.elem.src=a.source}),this},a.prototype.grayscale=function(){return g(function(a,b){var c=.34*a[b]+.5*a[b+1]+.16*a[b+2];a[b]=c,a[b+1]=c,a[b+2]=c}),this},a.prototype.mirror=function(){return h.forEach(function(a){k.reset(a.elem.width,a.elem.height),k.context.save(),k.context.translate(a.elem.width/2,a.elem.height/2),k.context.scale(-1,1),k.context.drawImage(a.elem,-a.elem.width/2,-a.elem.height/2,a.elem.width,a.elem.height),k.context.restore(),a.elem.src=k.canvas.toDataURL()}),this},a.prototype.resize=function(a,b){return a>=0&&b>=0&&h.forEach(function(c){k.drawImage(c.elem,0,0,Math.max(0,a),Math.max(0,b)),c.elem.src=k.canvas.toDataURL()}),this},a.prototype.rotate=function(a){return a>=0&&h.forEach(function(b){k.reset(b.elem.width,b.elem.height),k.context.save(),k.context.translate(b.elem.width/2,b.elem.height/2),k.context.rotate(a%360*Math.PI/180),k.context.drawImage(b.elem,-b.elem.width/2,-b.elem.height/2,b.elem.width,b.elem.height),k.context.restore(),b.elem.src=k.canvas.toDataURL()}),this},a.prototype.invert=function(){return g(function(a,b){a[b]=255-a[b],a[b+1]=255-a[b+1],a[b+2]=255-a[b+2]}),this},a.prototype.swap=function(a,b){return a&&b&&g(function(c,d){a.r&&a.r!==c[d]||a.g&&a.g!==c[d+1]||a.b&&a.b!==c[d+2]||a.a&&a.a!==c[d+3]||["r","g","b","a"].forEach(function(a,e){b.hasOwnProperty(a)&&(c[d+e]=b[a])})}),this},a});